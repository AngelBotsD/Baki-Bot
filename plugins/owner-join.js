let handler = async (m, { conn, text }) => {
    if (!text) return m.reply(`‚ö° Ingresa el enlace del Grupo.`);

    // Regex que captura el c√≥digo de cualquier enlace de WhatsApp, ignorando par√°metros extras
    let linkRegex = /chat\.whatsapp\.com\/([0-9A-Za-z]{20,24})/i;
    let match = text.match(linkRegex);
    if (!match) return m.reply('Enlace inv√°lido. Aseg√∫rate de copiarlo completo desde WhatsApp.');

    let code = match[1];

    try {
        let res = await conn.groupAcceptInvite(code);
        m.reply(`üêæ Me un√≠ correctamente al Grupo *${res}*`);
    } catch (e) {
        console.error('Error al unirse:', e); // Para depuraci√≥n
        let msg = '‚ùå No pude unirme al grupo.';

        // Mensajes de error claros seg√∫n tipo de fallo
        if (e?.status === 401 || /invitation code invalid/i.test(e.message)) {
            msg += ' El enlace es inv√°lido o expirado.';
        } else if (/too many participants/i.test(e.message)) {
            msg += ' El grupo est√° lleno.';
        } else if (/not authorized/i.test(e.message)) {
            msg += ' Mi n√∫mero no puede unirse a este grupo.';
        } else if (/already joined/i.test(e.message)) {
            msg += ' Ya estoy en este grupo.';
        } else {
            msg += ` Error: ${e.message || e}`;
        }

        m.reply(msg);
    }
};

handler.help = ['join <link>'];
handler.tags = ['owner'];
handler.command = ['join', 'entrar'];
handler.owner = true;

export default handler;